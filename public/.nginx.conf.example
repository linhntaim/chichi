server {
    listen 80;
    listen [::]:80;
    server_name localhost;
    root /path/to/public;

    ### Basic authentication
    #auth_basic "Protected Area";
    #auth_basic_user_file /path/to/.htpasswd;
    #satisfy any;
    # Ignore: IPs (GBU - Security Room)
    #allow 113.161.68.31;
    # Ignore: IPs (GBU - Office)
    #allow 113.161.68.89;
    # Ignore: IPs (JPN - Office)
    #allow 113.43.219.94;
    # Ignore: IPs (JPN - Office)
    #allow 124.36.26.238;
    # Other must fill username and password
    #deny all;
    # Ignore: Images
    #location ~ \.(jpg|jpeg|png|gif|svg|ico)$ {
    #    auth_basic off;
    #}

    ### Set default charset
    charset utf-8;

    ### Set default document
    index index.htm index.html index.php;

    ### Set mime for some specific file extension
    types {
        application/json json;
        font/woff woff;
        font/woff2 woff2;
        text/csv csv;
        text/plain txt;
        video/mp4 mp4;
    }

    ### Allow to include .html file in other .html files
    ssi on;
    ssi_last_modified on;
    ssi_min_file_chunk 1k;
    ssi_silent_errors off;
    ssi_types text/html;
    ssi_value_length 256;

    ### Enable cross-domain accessing
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Headers "Accept, Authorization, Content-Type, Origin, Referer, User-Agent, X-Authorization, X-Cognito, X-Device, X-Requested-With, X-Settings, X-Screen";
    add_header Access-Control-Allow-Methods "OPTIONS, GET, POST, PUT, DELETE";
    add_header Access-Control-Max-Age 86400;

    ### Force to use HTTPS
    add_header Strict-Transport-Security "max-age=86400; includeSubDomains";

    ### Not allow browsers to change content type of response
    add_header X-Content-Type-Options "nosniff";

    ### Not allow browsers to open downloaded file directly
    add_header X-Download-Options "noopen";

    ### Not allow browsers to open the website in an iframe of other websites
    add_header X-Frame-Options "sameorigin";

    ### Prevent from XSS attack
    add_header X-XSS-Protection "1; mode=block";

    ### Allow to load resources from known places only
    add_header Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: fonts.googleapis.com fonts.gstatic.com *.googletagmanager.com *.google-analytics.com";
    add_header X-Content-Security-Policy "allow 'self' 'unsafe-inline' 'unsafe-eval' data: blob: fonts.googleapis.com fonts.gstatic.com *.googletagmanager.com *.google-analytics.com";
    add_header X-WebKit-CSP "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: fonts.googleapis.com fonts.gstatic.com *.googletagmanager.com *.google-analytics.com";

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    ### Cache for static files
    location ~ \.(html|jpg|jpeg|png|gif|svg|ico|css|js|json|woff|woff2|mp4)$ {
        add_header Cache-Control "max-age=84600, public";
    }

    location ~ \.php$ {
        ### No cache for other requests
        add_header Cache-Control "no-cache, no-store, private";
        add_header Pragma "no-cache";

        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }
}